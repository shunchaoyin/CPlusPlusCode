## Chapter 6: Design Patterns and C++

### “隐藏的友元”？
隐藏的友元是指那些被声明为类的友元的非成员函数，它们在类的内部定义。通常来说，普通的友元函数会在类的外部定义，但隐藏友元则直接在类的定义中出现。由于这些函数位于类的作用域中，它们只能通过**参数依赖查找（Argument Dependent Lookup, ADL）**的方式被调用。

ADL 是一种查找方式，当调用一个函数时，编译器会根据函数参数的类型来查找可能的匹配，通常在参数类型的命名空间或类作用域中查找。因此，隐藏友元函数只能在与相关类型一起被使用时才会被找到和调用，避免了污染全局命名空间的可能性。

隐藏友元的优势
1. 减少重载数量：由于隐藏友元只能通过 ADL 被找到，这意味着编译器在函数查找时会考虑的重载数量大大减少，从而加快了编译速度。
2. 更简洁的错误消息：隐藏友元的设计使得编译器给出的错误消息比普通友元或其他候选方案更短、更易读。
3. 防止隐式转换：隐藏友元的一个特性是它们无法被调用，如果首先需要发生隐式转换。这意味着这些函数不会无意中被触发那些有可能进行隐式类型转换的调用，这帮助避免了一些难以发现的隐式转换错误。

ADL 机制：在 ADL 查找的过程中，编译器会只在参数的相关命名空间内查找对应的函数。这意味着，如果你要调用一个隐藏的友元函数，编译器要求该函数的参数已经是目标类型，而不是需要通过某种隐式转换来成为目标类型。

防止隐式转换：在调用隐藏友元函数时，如果函数参数需要进行隐式转换，编译器可能不会找到这个隐藏友元，因为它的查找机制是基于实际参数类型的，而不是转换后的类型。因此，如果参数不能直接匹配，隐藏友元就不会被选择为一个有效的候选函数。这有效地阻止了一些可能会引入问题的隐式转换调用。